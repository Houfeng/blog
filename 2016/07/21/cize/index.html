<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Houfeng"><link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16"><link rel="manifest" href="/favicons/manifest.json"><link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5"><meta name="theme-color" content="#ffffff"><meta name="description" content="CIZE是什么？CIZE是一个「持续集成」工具，希望能让开发人员更快捷的搭建一个完整、可靠、便捷的CI服务。甚至可以像Gulp或Grunt一样，仅仅通过一个cizefile.js即可完成几乎所有的工作。如果您对它有一点兴趣，欢迎到GitHub加个st"><meta name="keywords" content=""><title>基于 Node.js 的轻量「持续集成」工具 CIZE · Houfeng's Blog</title><link rel="icon" href="/favicons/favicon.ico"><link rel="canonical" href="http://blog.houfeng.net/2016/07/21/cize/"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3F16290d6dfe4977c6ba2d32fb7a483731";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script></head><body><div style="display:none;"><img src="/favicons/300x300.png"></div><div id="main"><header><a href="/." class="logo">Houfeng's Blog</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">首页</a></li><li class="nav-link"><a href="/archives/" target="_self">归档</a></li><li class="nav-link"><a href="/about/" target="_self">关于</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">基于 Node.js 的轻量「持续集成」工具 CIZE</h1><span class="post-time">Jul 21, 2016</span><div id="sidebar" class="post-sidebar"><h3 class="heading">目录</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#CIZE-是什么？"><span class="toc-text">CIZE 是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#快速搭建"><span class="toc-text">快速搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#全局安装"><span class="toc-text">全局安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写-Job"><span class="toc-text">编写 Job</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定义-Project"><span class="toc-text">定义 Project</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#定义-Job"><span class="toc-text">定义 Job</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用-js-编写的-Job"><span class="toc-text">用 js 编写的 Job</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用-shell-编写的-Job"><span class="toc-text">用 shell 编写的 Job</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#定时执行的-Job"><span class="toc-text">定时执行的 Job</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#监听其它-Job-的-Job"><span class="toc-text">监听其它 Job 的 Job</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#串行执行的-Job"><span class="toc-text">串行执行的 Job</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#并行执行的-Job"><span class="toc-text">并行执行的 Job</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多步嵌套的-Job"><span class="toc-text">多步嵌套的 Job</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编写一个扩展"><span class="toc-text">编写一个扩展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#服务选项"><span class="toc-text">服务选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在-cizefile-js-中配置"><span class="toc-text">在 cizefile.js 中配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过命令行工具"><span class="toc-text">通过命令行工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更多内容"><span class="toc-text">更多内容</span></a></li></ol></div><div class="post-content"><h2 id="CIZE-是什么？"><a href="#CIZE-是什么？" class="headerlink" title="CIZE 是什么？"></a>CIZE 是什么？</h2><p>CIZE 是一个「持续集成」工具，希望能让开发人员更快捷的搭建一个完整、可靠、便捷的 CI 服务。<br>甚至可以像 Gulp 或 Grunt 一样，仅仅通过一个 cizefile.js 即可完成几乎所有的工作。</p>
<blockquote>
<p>如果您对它有一点兴趣，欢迎到 GitHub 加个 star 以关注它。<br><a href="https://github.com/Houfeng/cize" target="_blank" rel="external">https://github.com/Houfeng/cize</a></p>
</blockquote>
<a id="more"></a>
<p><a href="http://badge.fury.io/js/cize" target="_blank" rel="external"><img src="https://badge.fury.io/js/cize.svg" alt="npm version"></a><a href="https://travis-ci.org/Houfeng/cize" target="_blank" rel="external"><img src="https://travis-ci.org/Houfeng/cize.svg?branch=master" alt="Build Status"></a> </p>
<p><img src="https://raw.githubusercontent.com/houfeng/cize/master/screenshot/monitor.png" alt="https://raw.githubusercontent.com/houfeng/cize/master/screenshot/monitor.png"></p>
<h2 id="快速搭建"><a href="#快速搭建" class="headerlink" title="快速搭建"></a>快速搭建</h2><h3 id="全局安装"><a href="#全局安装" class="headerlink" title="全局安装"></a>全局安装</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ [sudo] npm install cize -g</div></pre></td></tr></table></figure>
<h3 id="编写-Job"><a href="#编写-Job" class="headerlink" title="编写 Job"></a>编写 Job</h3><p>新建 cizefile.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ mkdir your_path</div><div class="line">$ cd your_path</div><div class="line">$ vim cizefile.js</div></pre></td></tr></table></figure></p>
<p>输入如下内容<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//定义「项目」</span></div><div class="line"><span class="keyword">const</span> demo = cize.project(<span class="string">'demo'</span>, &#123;&#125;);</div><div class="line"></div><div class="line"><span class="comment">//定义一个 Job，这是一个最基础的 Job</span></div><div class="line">demo.job(<span class="string">'hello'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">self</span>) </span>&#123;</div><div class="line">  self.console.log(<span class="string">'hello world'</span>);</div><div class="line">  self.done();</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>然后，在「工作目录」中执行 <strong>cize</strong> 启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ cize</div><div class="line">Strarting...</div><div class="line">The server on &quot;localhost:9000&quot; started</div></pre></td></tr></table></figure>
<p>默认会启动和 CPU 核数相同的「工作进程」。</p>
<p>接下来，可以在浏览器中访问 <strong><a href="http://localhost:9000" target="_blank" rel="external">http://localhost:9000</a></strong>，并可以在 UI 中手动触发这个名为 <strong>hello</strong> 的 Job。</p>
<h2 id="定义-Project"><a href="#定义-Project" class="headerlink" title="定义 Project"></a>定义 Project</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> demo = cize.project(<span class="string">'demo'</span>, &#123;</div><div class="line">  ...</div><div class="line">  <span class="comment">//可以在此添加针对项目的配置</span></div><div class="line">  ...</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>注意，即便一个项目不需要任何配置，也不能省略第二个参数，没有第二个参数时 <strong>cize.project(name</strong> 为获取指定的项目。</p>
<h2 id="定义-Job"><a href="#定义-Job" class="headerlink" title="定义 Job"></a>定义 Job</h2><p>假定现在已经有一个定义好的名为 <strong>demo</strong> 的 <strong>project</strong> </p>
<h3 id="用-js-编写的-Job"><a href="#用-js-编写的-Job" class="headerlink" title="用 js 编写的 Job"></a>用 js 编写的 Job</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">demo.job(<span class="string">'test'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">self</span>) </span>&#123;</div><div class="line">  self.console.log(<span class="string">'test'</span>);</div><div class="line">  self.done();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>这是最基础的 Job 类型，是其它 Job 类型或「扩展」的基础。</p>
<h3 id="用-shell-编写的-Job"><a href="#用-shell-编写的-Job" class="headerlink" title="用 shell 编写的 Job"></a>用 shell 编写的 Job</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">demo.job(<span class="string">'test'</span>, cize.shell(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">/*</span></div><div class="line">    echo "hello world"</div><div class="line">  */</div><div class="line">&#125;));</div></pre></td></tr></table></figure>
<p>定义一个用 SHELL 编写的 Job，用到了 cize.shell，这是一个「内置扩展」。</p>
<h3 id="定时执行的-Job"><a href="#定时执行的-Job" class="headerlink" title="定时执行的 Job"></a>定时执行的 Job</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">demo.job(<span class="string">'test'</span>, cize.cron(<span class="string">'* */2 * * * *'</span>, cize.shell(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">/*</span></div><div class="line">    echo "hello world"</div><div class="line">  */</div><div class="line">&#125;)));</div></pre></td></tr></table></figure>
<p>如上定义了一个每两分种触发一次的 Job 并且，嵌套使用了 shell.</p>
<h3 id="监听其它-Job-的-Job"><a href="#监听其它-Job-的-Job" class="headerlink" title="监听其它 Job 的 Job"></a>监听其它 Job 的 Job</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">demo.job(<span class="string">'test2'</span>, cize.by(<span class="string">'test1'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">self</span>)</span>&#123;</div><div class="line">  self.console.log(<span class="string">'hello'</span>);</div><div class="line">  self.done();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>如下，在 test1 执行成功后，将会触发 test2</p>
<h3 id="串行执行的-Job"><a href="#串行执行的-Job" class="headerlink" title="串行执行的 Job"></a>串行执行的 Job</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">demo.job(<span class="string">'test'</span>, cize.series([</div><div class="line">  <span class="string">"test1"</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">self</span>)</span>&#123;</div><div class="line">    self.console.log(<span class="string">'hello'</span>);</div><div class="line">    self.done();</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"test3"</span></div><div class="line">]));</div></pre></td></tr></table></figure>
<p>series 是一个内置扩展，可以定义一个「串行执行」多个步骤的任务列表，每个步骤可以是一个任意类型的 job，<br>也可以是指定要调用的其它 Job 的名称。</p>
<h3 id="并行执行的-Job"><a href="#并行执行的-Job" class="headerlink" title="并行执行的 Job"></a>并行执行的 Job</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">demo.job(<span class="string">'test'</span>, cize.parallel([</div><div class="line">  <span class="string">"test1"</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">self</span>)</span>&#123;</div><div class="line">    self.console.log(<span class="string">'hello'</span>);</div><div class="line">    self.done();</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"test3"</span></div><div class="line">]));</div></pre></td></tr></table></figure>
<p>series 是一个内置扩展，可以定义一个「并行执行」多个步骤的任务列表，每个步骤可以是一个任意类型的 job，<br>也可以是指定要调用的其它 Job 的名称。</p>
<h3 id="多步嵌套的-Job"><a href="#多步嵌套的-Job" class="headerlink" title="多步嵌套的 Job"></a>多步嵌套的 Job</h3><p>CIZE 所有的 Job 可以自由嵌套，例如：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">demo.job(<span class="string">'test'</span>, cize.parallel([</div><div class="line">  <span class="string">"test1"</span>,</div><div class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">self</span>)</span>&#123;</div><div class="line">    self.console.log(<span class="string">'hello'</span>);</div><div class="line">    self.done();</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"test3"</span>,</div><div class="line">  cize.series([</div><div class="line">    <span class="string">"test4"</span>,</div><div class="line">    cize.shell(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">/*</span></div><div class="line">        echo hello</div><div class="line">      */</div><div class="line">    &#125;)</div><div class="line">  ])</div><div class="line">]));</div></pre></td></tr></table></figure></p>
<p>当你使用一个「外部扩展」时，也可以混合使用。</p>
<h2 id="编写一个扩展"><a href="#编写一个扩展" class="headerlink" title="编写一个扩展"></a>编写一个扩展</h2><p>如上用到的 cize.shell、cize.series、cize。parallel、cize.cron、cize.by 是 cize 默契认包含的「内置扩展」。</p>
<p>编写一个「外部扩展」和「内置扩展」并无本质区别，如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">options...</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">self</span>)</span>&#123;</div><div class="line">    <span class="comment">//处理逻辑</span></div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>如查需要在 Job 定义时进行一些处理，可以使用 <strong>register</strong> ，如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">options...</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    register: <span class="function"><span class="keyword">function</span>(<span class="params">Job</span>)</span>&#123;</div><div class="line">      <span class="comment">//Job 是你的「自定义 Job 类型」</span></div><div class="line">      <span class="comment">//注册时逻辑</span></div><div class="line">    &#125;,</div><div class="line">    runable: <span class="function"><span class="keyword">function</span>(<span class="params">self</span>)</span>&#123;</div><div class="line">      <span class="comment">//执行时逻辑</span></div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>可以将扩展发布为一个「npm 包」，让更多的人使用。</p>
<h2 id="服务选项"><a href="#服务选项" class="headerlink" title="服务选项"></a>服务选项</h2><p>可以通过一些选择去控制 CI 服务的端口、密钥等，有两种方式，如下</p>
<h3 id="在-cizefile-js-中配置"><a href="#在-cizefile-js-中配置" class="headerlink" title="在 cizefile.js 中配置"></a>在 cizefile.js 中配置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cize.config(&#123;</div><div class="line">  port: <span class="number">9000</span>,</div><div class="line">  secret: <span class="string">'12345'</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="通过命令行工具"><a href="#通过命令行工具" class="headerlink" title="通过命令行工具"></a>通过命令行工具</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cize ./ -p=port -s=secret</div></pre></td></tr></table></figure>
<p>通过 cize -h 可以查看完整的说明<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Usage:</div><div class="line">  cize [folder|file] [options]</div><div class="line"></div><div class="line">Options:</div><div class="line">  -w   <span class="built_in">set</span> the number of workers</div><div class="line">  -p   <span class="built_in">set</span> the port</div><div class="line">  <span class="_">-s</span>   <span class="built_in">set</span> the secret</div><div class="line">  -h   display <span class="built_in">help</span> information</div><div class="line"></div><div class="line">Example:</div><div class="line">  cize ./ -p=9000 <span class="_">-s</span>=12345 -w=4</div></pre></td></tr></table></figure></p>
<h2 id="更多内容"><a href="#更多内容" class="headerlink" title="更多内容"></a>更多内容</h2><p>请访问 wiki: <a href="https://github.com/Houfeng/cize/wiki" target="_blank" rel="external">https://github.com/Houfeng/cize/wiki</a></p>
<blockquote>
<p>如果您对它有一点问题或建议，请到 GitHub 通过 issue 提出您的疑问或建议。 <a href="https://github.com/Houfeng/cize-gitlab/issues" target="_blank" rel="external">https://github.com/Houfeng/cize-gitlab/issues</a></p>
</blockquote>
</div></article><div class="tags"></div><div class="paginator"><a href="/2016/07/29/confman/" class="prev"><i class="iconfont icon-left"></i><span> 上一页</span></a><a href="/2016/04/13/using-nokitjs-to-solve-the-problem-of-cross-domain/" class="next"><span>下一页</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div data-thread-key="http://blog.houfeng.net/2016/07/21/cize/index.html" data-title="基于 Node.js 的轻量「持续集成」工具 CIZE" data-url="http://blog.houfeng.net/2016/07/21/cize/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "houfeng" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section></section><footer><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2009-2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Houfeng</span></p></div><label id="back2top"><i class="iconfont icon-up"></i></label></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>