<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Houfeng"><link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16"><link rel="manifest" href="/favicons/manifest.json"><link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5"><meta name="theme-color" content="#ffffff"><meta name="description" content="简介Nokit是一个简单易用的基于Nodejs的Web开发框架，默认提供了MVC/NSP/RESTful等支持，并提供对应项目模板、管理工具。"><meta name="keywords" content=""><title>一个基于 Node.js 的 Web 开发框架 - Nokitjs · Houfeng's Blog</title><link rel="icon" href="/favicons/favicon.ico"><link rel="canonical" href="http://blog.houfeng.net/2015/12/07/nokitjs/"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript">var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3F16290d6dfe4977c6ba2d32fb7a483731";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script></head><body><div style="display:none;"><img src="/favicons/300x300.png"></div><div id="main"><header><a href="/." class="logo">Houfeng's Blog</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">首页</a></li><li class="nav-link"><a href="/archives/" target="_self">归档</a></li><li class="nav-link"><a href="/about/" target="_self">关于</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">一个基于 Node.js 的 Web 开发框架 - Nokitjs</h1><span class="post-time">Dec 7, 2015</span><div id="sidebar" class="post-sidebar"><h3 class="heading">目录</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#资源"><span class="toc-text">资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装和更新"><span class="toc-text">安装和更新</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装-nokit"><span class="toc-text">安装 nokit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#更新-nokit"><span class="toc-text">更新 nokit</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#命令行工具"><span class="toc-text">命令行工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查看版本"><span class="toc-text">查看版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建应用"><span class="toc-text">创建应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#运行应用"><span class="toc-text">运行应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#停止应用"><span class="toc-text">停止应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#重启应用"><span class="toc-text">重启应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看运行中的应用"><span class="toc-text">查看运行中的应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开机自启动"><span class="toc-text">开机自启动</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在代码中引用"><span class="toc-text">在代码中引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSP"><span class="toc-text">NSP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RESTful"><span class="toc-text">RESTful</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter"><span class="toc-text">Filter</span></a></li></ol></div><div class="post-content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Nokit 是一个简单易用的基于 Nodejs 的 Web 开发框架，默认提供了 MVC / NSP / RESTful 等支持，并提供对应项目模板、管理工具。</p>
<a id="more"></a>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><blockquote>
<ul>
<li>GitHub <a href="https://github.com/nokitjs/nokit" target="_blank" rel="external">https://github.com/nokitjs/nokit</a> (欢迎 star)</li>
<li>使用说明 <a href="https://github.com/nokitjs/nokit/wiki" target="_blank" rel="external">wiki</a></li>
<li>问题反馈 <a href="https://github.com/nokitjs/nokit/issues" target="_blank" rel="external">issues</a></li>
<li>主页 <a href="http://nokit.org" target="_blank" rel="external">http://nokit.org</a></li>
</ul>
</blockquote>
<h2 id="安装和更新"><a href="#安装和更新" class="headerlink" title="安装和更新"></a>安装和更新</h2><h4 id="安装-nokit"><a href="#安装-nokit" class="headerlink" title="安装 nokit"></a>安装 nokit</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[sudo] npm install nokitjs [-g]</div></pre></td></tr></table></figure>
<h4 id="更新-nokit"><a href="#更新-nokit" class="headerlink" title="更新 nokit"></a>更新 nokit</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[sudo] npm update nokitjs [-g]</div></pre></td></tr></table></figure>
<h2 id="命令行工具"><a href="#命令行工具" class="headerlink" title="命令行工具"></a>命令行工具</h2><p>使用 “<strong>命令行工具</strong>” 时必须<strong>全局</strong>安装 nokitjs (全局安装的同时也可以在 app 中本地安装 nokitjs)，Nokit 应用只需在磁盘建立应用目录，并新建相关文件和目录即可， Nokit 提供了方便的命令行工具。</p>
<blockquote>
<p>命令行工具还提供了进程管理相关功能，确保应用能够持续稳定的运行，并能在遇到故障时快速自动恢复。</p>
</blockquote>
<h4 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[sudo] nokit [?]</div></pre></td></tr></table></figure>
<h4 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[sudo] nokit create [name] [mvc|nsp|restful] [folder]</div></pre></td></tr></table></figure>
<p>以上命令会生成一个最简单的应用所需要的目录结构和配置。</p>
<ol>
<li>name 一般不建议省略（省略时为 nokit-app），name 将会作为应用的根目录名称</li>
<li>type 默认为 mvc 也可以指定为 nsp 或 restful ，指定类型后将会创建对应的应用模板</li>
<li>folder 为目标目录，省略时将默认为当前所在目录。</li>
</ol>
<h4 id="运行应用"><a href="#运行应用" class="headerlink" title="运行应用"></a>运行应用</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[sudo] nokit start [port] [root] [-env:&lt;name&gt;] [-cluster[:num]] [-watch[:.ext,...]] [node-opts]</div></pre></td></tr></table></figure>
<ol>
<li>-env 指定运行配置名称，将会根据 “配置名称” 加载 app.xxx.json (xxx 为指定的配置名称) 作为应用配置文件。</li>
<li>-cluster 选项可以开启 “单机集群模式”，使应用有效的利用多核 CPU，也使应用更加健壮可靠，-cluster 选项可以指定进程数，如 -cluster:4 ，默认为 CPU 核数。</li>
<li>-watch 选项开启后，在应用文件发生改变时会自动完成进程重启，默认任何文件变更都将触发重启，也可以指定文件类型，如 -watch:.js,.html,.css</li>
<li>-public 一般用于为 html/js/css 等静态资源启动一个临时 WebServer，指定静态资源目录，静态资源目录为 root 的相对目录。</li>
<li>-cache 一般用于为 html/js/css 等静态资源启动一个临时 WebServer，指定缓存配置，例如 -cache:0 不向浏览器发送缓存 header 信息。</li>
<li>–debug 为 nodejs 选项，可以开启 debug 模式，开启后可以使用 nodejs 内置调试工具调式，也可以使用 node-inspector 等工具进行调试。</li>
</ol>
<h4 id="停止应用"><a href="#停止应用" class="headerlink" title="停止应用"></a>停止应用</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[sudo] nokit stop [pid|all]</div></pre></td></tr></table></figure>
<p>可以指定 pid (进程ID，可以用过 nokit list 查看)，停止指定的的应用，也可以省略停止所有应用</p>
<h4 id="重启应用"><a href="#重启应用" class="headerlink" title="重启应用"></a>重启应用</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[sudo] nokit restart [pid|all]</div></pre></td></tr></table></figure>
<p>可以指定 pid (进程ID，可以用过 nokit list 查看)，重启指定的的应用，也可以省略重启所有应用</p>
<h4 id="查看运行中的应用"><a href="#查看运行中的应用" class="headerlink" title="查看运行中的应用"></a>查看运行中的应用</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[sudo] nokit list</div></pre></td></tr></table></figure>
<p>查看所有已启动的应用</p>
<h4 id="开机自启动"><a href="#开机自启动" class="headerlink" title="开机自启动"></a>开机自启动</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[sudo] nokit autostart [on|off] [-uid:[domain\]user [-pwd:password]]</div></pre></td></tr></table></figure>
<p>autostart 命令目前支持 win32 和 linux 平台，此命令需要管理员权限，如 ubuntu 需要使用 <strong>sudo</strong> ，<br>在 windows 平台会弹出 “用户账户控制” 提示框。<br>-uid 和 -pwd 参数仅在 win32 平台有效，其它平台将被忽略，在不指定 -uid 、-pwd 参数时，需有用户登录到 windows<br>才会自动启动 Nokit App，当指定 -uid、-pwd 时，只要启动 windows 就会自动启动 Nokit App。<br>无论是登录 windows 的账户或是通过 -uid 提定的账户，需要是安装 nodejs 和 npm 时所用的账户。</p>
<h2 id="在代码中引用"><a href="#在代码中引用" class="headerlink" title="在代码中引用"></a>在代码中引用</h2><p>除了使用命令行工具，也可以在代码中引用 nokit 的方式来运行 nokit 应用，<br>在代码中引用 nokit，将不能利用 nokit 的进程管理功能，这时可以直接运行，或者使用 pm2、forever 等工具进行管理。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> nokit = <span class="built_in">require</span>(<span class="string">"nokitjs"</span>);</div><div class="line"><span class="keyword">var</span> server = <span class="keyword">new</span> nokit.Server(&#123;</div><div class="line">    root : <span class="string">"应用根目录"</span>,</div><div class="line">    port : <span class="number">8000</span></div><div class="line">&#125;);</div><div class="line">server.start();</div></pre></td></tr></table></figure></p>
<p>无论任种方式，启动成功后，即可浏览器访问 “<a href="http://localhost:8000" target="_blank" rel="external">http://localhost:8000</a>“ (端口请换成具体应用的正确的端口)，<br>示例站点 <a href="http://jser.cc" target="_blank" rel="external">http://jser.cc</a> (还未全部开发完毕)</p>
<h2 id="NSP"><a href="#NSP" class="headerlink" title="NSP"></a>NSP</h2><p>NSP 全称为 <strong>Nokit Server Pages</strong> 是一种类似 <strong>asp / asp.net</strong> 的 Web 应用开发模式，<br>NSP 支持 include 引用其它页面，也支持 <strong>master 母板页</strong> 技术。</p>
<p>一般目录结构<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">根目录</div><div class="line">│ app.json</div><div class="line">│ app.js</div><div class="line">├─layout</div><div class="line">│     date.nsp</div><div class="line">│     master.nsp</div><div class="line">├─model</div><div class="line">└─public</div><div class="line">    │  index.nsp</div><div class="line">    │  index.nsp.js</div><div class="line">    └─style</div><div class="line">         common.css</div></pre></td></tr></table></figure></p>
<p>NSP 页面 (*.nsp) 基本介绍</p>
<p>输出内容<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> <span class="tag">&lt;<span class="name">%=</span> "输出内容" %&gt;</span> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- this 指向页面处理器，无处理器页面指向默认处理器对象 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span> <span class="tag">&lt;<span class="name">%=</span> <span class="attr">this.context.request.formData</span>("<span class="attr">name</span>") %&gt;</span> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>循环<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">%</span> $<span class="attr">.each</span>(<span class="attr">this.list</span>,<span class="attr">function</span>(<span class="attr">i</span>,<span class="attr">item</span>)&#123; %&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">item.name</span> %&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%</span> &#125;) %&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>分支<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">this.type</span>==<span class="string">'a'</span>)&#123; %&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>a<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%</span> &#125;<span class="attr">else</span>&#123; %&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>b<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></div></pre></td></tr></table></figure></p>
<p>包含<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">%</span> $<span class="attr">.include</span>("<span class="attr">..</span>/<span class="attr">layout</span>/<span class="attr">head.nsp</span>") %&gt;</span></div></pre></td></tr></table></figure></p>
<p>母板页(<strong>Master Page</strong>)<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span> <span class="tag">&lt;<span class="name">%</span> $<span class="attr">.placeHolder</span>("<span class="attr">content1</span>") %&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span> <span class="tag">&lt;<span class="name">%</span> $<span class="attr">.placeHolder</span>("<span class="attr">content2</span>") %&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">...</div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>内容页(<strong>Content Page</strong>)<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">%</span> $<span class="attr">.master</span>("<span class="attr">.</span>/<span class="attr">master.nsp</span>") %&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">%</span> $<span class="attr">.placeBegin</span>("<span class="attr">content1</span>") %&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>content1<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%</span> $<span class="attr">.placeEnd</span>() %&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">%</span> $<span class="attr">.placeBegin</span>("<span class="attr">content2</span>") %&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>content2<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">%</span> $<span class="attr">.placeEnd</span>() %&gt;</span></div></pre></td></tr></table></figure></p>
<p>NSP 页面处理器 (*.nsp.js) 基本介绍<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//定义页面处理器类型</span></div><div class="line"><span class="keyword">var</span> IndexPresenter = <span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"></div><div class="line"><span class="comment">//初始化方法，每次回发都将触发 init 方法</span></div><div class="line">IndexPresenter.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">    <span class="comment">/*</span></div><div class="line">    self.server //当前 server 实例</div><div class="line">    self.context //当前请上下文对象</div><div class="line">    self.request //同 context.request，请求对象</div><div class="line">    self.response //同 context.response 响应对象</div><div class="line">    self.context.request.queryData['name'] 可以获取 queryString 对应数据</div><div class="line">    self.context.request.formData['name'] 可以获取 post 数据</div><div class="line">    self.context.data("name") 可以获取客户端传过来的 queryString 或 formData</div><div class="line">    self.context.request.cookie 获取来自客户的 cookie</div><div class="line">    self.context.respone.cookie 向客户端发送 cookie</div><div class="line">    se轩.context.session 访问 session 数据</div><div class="line">    */</div><div class="line">    self.name = <span class="string">'Nokit NSP'</span>;</div><div class="line">    <span class="comment">//init（初始化）完成后，需要调用 ready 方法，通知初始化完成</span></div><div class="line">    self.ready();</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//默认方法，首次打开页面，会触发 load 方法</span></div><div class="line">IndexPresenter.prototype.load = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">    <span class="comment">//由于 nokit 为异步处理，调用 self.render() 方法向浏览器呈现页面.</span></div><div class="line">    <span class="comment">//不要在 init 方法调用 self.render() </span></div><div class="line">    self.render();</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//事件方法，可以绑定到页面中的 html 控件</span></div><div class="line">IndexPresenter.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">    <span class="keyword">var</span> val = <span class="built_in">parseInt</span>(self.numBox.val());</div><div class="line">    self.numBox.val(++val);</div><div class="line">    self.numBox.css(<span class="string">"border"</span>,<span class="string">"solid 1px red"</span>);</div><div class="line">    self.render();</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>页面绑定<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 绑定到处理器方法 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"nsp.call('add')"</span> <span class="attr">value</span>=<span class="string">'add'</span> /&gt;</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>共享元素</strong>，将普通 DOM 元素通过 <strong>nsp-id</strong> 声明为客户端和服务端的共享元素，便可以在客户端和服务端同时操作指定元素，<br>并能在回发时保持状态，类似 Asp.NET 的 WebForms，但理念、原理又非常不同，NSP 共享元素非常轻量，更简洁易用。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 此元素可以在服务端和客户端同时访问 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">"hello"</span> <span class="attr">nsp-id</span>=<span class="string">'test'</span> /&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">Index.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">    <span class="comment">//服务端提供类 jQuery 的元素操作 API (兼容部分常用 jQUery API)</span></div><div class="line">    self.test.val(<span class="string">'你好'</span>); </div><div class="line">    self.render();</div><div class="line">&#125;;</div><div class="line"><span class="string">``</span><span class="string">`    </span></div><div class="line"></div><div class="line">## MVC</div><div class="line">Nokit MVC 是一种设计简约、符合 MVC 模式 Web 应用开发模式。</div><div class="line"></div><div class="line">一般目录结构</div><div class="line"></div><div class="line">`<span class="string">``</span>javascript</div><div class="line">根目录</div><div class="line">│ app.json</div><div class="line">│ app.js</div><div class="line">├─controllers</div><div class="line">│    home.js</div><div class="line">├─models</div><div class="line">├─public</div><div class="line">│  └─style</div><div class="line">│       common.css</div><div class="line">└─views</div><div class="line">     date.html</div><div class="line">     home.html</div><div class="line">     master.html</div></pre></td></tr></table></figure>
<blockquote>
<p>views 目录存放的是视图，视图和 NSP 的页面相似，支持 include 和 master，语法也完全相同，<br>不同的是在 mvc 的视图中 <strong>this</strong> 指向的是模型，视图具有单一的责职 ，就是呈现模型中的数据。</p>
</blockquote>
<p>controllers 是控制器目录，单个文件为一个控制器，用来响应接受来自用户的请求，并传递给模型，<br>然后，完成模型和视图的装配。<br>models 为模型目录，nokit 对模型没有统一的要求和控制，应用的业务逻辑应在模型中完成。</p>
<p>MVC 的控制器示例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//定义控制器类型</span></div><div class="line"><span class="keyword">var</span> HomeController = <span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">默认 action ，</div><div class="line">通常用户直接请求某一 url 会被路由到指定 controller 的默认 action</div><div class="line">*/</div><div class="line">HomeController.prototype.index = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">    </div><div class="line">    <span class="comment">/*</span></div><div class="line">    self.context 可以访问当前请求上下文对象</div><div class="line">    self.context.routeData["name"] 可以获取路由数据</div><div class="line">    self.context.request.queryData['name'] 可以获取 queryString 对应数据</div><div class="line">    self.context.request.formData['name'] 可以获取 post 数据</div><div class="line">    self.context.data("name") 可以获取客户端传过来的 queryString 或 formData</div><div class="line">    self.context.request.cookie 获取来自客户的 cookie</div><div class="line">    self.context.respone.cookie 向客户端发送 cookie</div><div class="line">    se轩.context.session 访问 session 数据</div><div class="line">    */</div><div class="line">    </div><div class="line">    <span class="comment">//通过 self.render 方法呈现指定的视图，并进行模型绑定</span></div><div class="line">    self.render(<span class="string">"home.html"</span>, &#123;</div><div class="line">        <span class="string">"name"</span>: <span class="string">"Nokit MVC"</span></div><div class="line">    &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>MVC 的 app.json 配置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="comment">/*</span></div><div class="line">    配置 handler ，将指定的请求交由 MVC Handler 处理，支持正则表达式，</div><div class="line">    如示例，将应用的所有请求都交由 MVC 处理，</div><div class="line">    在找不到匹配的路由配置时，会转由 Static Handler 处理</div><div class="line">    */</div><div class="line">    <span class="string">"handlers"</span>: &#123;</div><div class="line">        <span class="string">"^/"</span>: <span class="string">"$./handlers/mvc"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="string">"mvc"</span>: &#123;</div><div class="line">        <span class="comment">/*</span></div><div class="line">        配置 MVC 相关代码文件的存放目录，指定 controller 和 view 的目录位置，</div><div class="line">        model 不用配置。</div><div class="line">        */</div><div class="line">        <span class="string">"paths"</span>: &#123;</div><div class="line">            <span class="string">"controller"</span>: <span class="string">"./controllers"</span>,</div><div class="line">            <span class="string">"view"</span>: <span class="string">"./views"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="comment">/*</span></div><div class="line">        每一个路由至少需要指定 pattern(URL匹配模式) 和 target(目标contrller)</div><div class="line">        还可以通过配置 action 项指定对应的 action (controller方法)。</div><div class="line">        pattern 格式示例 "/user/&#123;userId&#125;" 其中 userId 是占位符变量，</div><div class="line">        可以在 controller 中通过 context.routeData['userId'] 获取。</div><div class="line">        */</div><div class="line">        <span class="string">"routes"</span>: [&#123;</div><div class="line">            <span class="string">"pattern"</span>: <span class="string">"/home"</span>,</div><div class="line">            <span class="string">"target"</span>: <span class="string">"./home.js"</span></div><div class="line">        &#125;,&#123;</div><div class="line">            <span class="string">"pattern"</span>: <span class="string">"/"</span>,</div><div class="line">            <span class="string">"target"</span>: <span class="string">"./home.js"</span></div><div class="line">        &#125;]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="RESTful"><a href="#RESTful" class="headerlink" title="RESTful"></a>RESTful</h2><p>Nokit 用来开发 RESTful Service 是非常方便和简单的，通过简洁的 URL 路由配置，抽象出和资源对应的请求处理程序文件即可，<br>可以在处理程序中，根据需求实现 get / post / put 等 HttpMethod 即可。</p>
<p>一般目录结构<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">根目录</div><div class="line">│ app.json</div><div class="line">│ app.js</div><div class="line">├─public</div><div class="line">│  │  index.nsp</div><div class="line">│  └─style</div><div class="line">│       common.css</div><div class="line">└─restful</div><div class="line">      user.js</div></pre></td></tr></table></figure></p>
<p>REST 的资源控制器示例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//定义资源控制器类型，通常一个资源类型视为一个控制器</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">HelloController</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * post 处理方法</div><div class="line"> **/</div><div class="line">HelloController.prototype.post = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">    <span class="comment">/*</span></div><div class="line">    self.context 可以访问当前请求上下文对象</div><div class="line">    self.context.routeData["name"] 可以获取路由数据</div><div class="line">    self.context.request.queryData['name'] 可以获取 queryString 对应数据</div><div class="line">    self.context.request.formData['name'] 可以获取 post 数据</div><div class="line">    self.context.data("name") 可以获取客户端传过来的 queryString 或 formData</div><div class="line">    self.context.request.body 可以访问请求的主体对象</div><div class="line">    */</div><div class="line">    self.out(&#123;</div><div class="line">        <span class="string">"status"</span>: <span class="string">"success"</span>,</div><div class="line">        <span class="string">"message"</span>: <span class="string">"Hello "</span> + self.context.routeData[<span class="string">"name"</span>] + <span class="string">"!"</span></div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * get 处理方法</div><div class="line"> **/</div><div class="line">HelloController.prototype.get = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</div><div class="line">    self.out(&#123;</div><div class="line">        <span class="string">"status"</span>: <span class="string">"success"</span>,</div><div class="line">        <span class="string">"message"</span>: <span class="string">"Hello "</span> + self.context.routeData[<span class="string">"name"</span>] + <span class="string">"!"</span></div><div class="line">    &#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>REST 的 app.json 配置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="comment">/*</span></div><div class="line">    配置 handler ，将指定的请求交由 REST Handler 处理，支持正则表达式，</div><div class="line">    如示例，/api/... 开头的请求，交由 REST Handler 处理</div><div class="line">    */</div><div class="line">    <span class="string">"handlers"</span>: &#123;</div><div class="line">        <span class="string">"^/api/"</span>: <span class="string">"$./handlers/restful"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="string">"restful"</span>: &#123;</div><div class="line">        <span class="string">"path"</span>: <span class="string">"./restful"</span>, <span class="comment">//指定资源控制器的存放目录</span></div><div class="line">        <span class="comment">/*</span></div><div class="line">        每一个路由至少需要指定 pattern(URL匹配模式) 和 target(目标contrller)</div><div class="line">        pattern 格式示例 "/user/&#123;userId&#125;" 其中 userId 是占位符变量，</div><div class="line">        REST 的路由配置没有 action 配置项。</div><div class="line">        */</div><div class="line">        <span class="string">"routes"</span>: [&#123;</div><div class="line">             <span class="string">"pattern"</span>: <span class="string">"/api/hello/&#123;name&#125;"</span>,</div><div class="line">             <span class="string">"target"</span>: <span class="string">"./hello"</span></div><div class="line">        &#125;]</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h2><p>Filter 可以在请求的不同阶段截获请求，进行相关逻辑处理后，继续向下处理请求或结束请求，一个完整的 filter 包括 4 个事件，如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//定义一个 Filter</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">DemoFilter</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="comment">//在请求开始时</span></div><div class="line">DemoFilter.prototype.onRequestBegin = <span class="function"><span class="keyword">function</span> (<span class="params">context, next</span>) </span>&#123;</div><div class="line">    next();</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//在收到数据时</span></div><div class="line">DemoFilter.prototype.onReceived = <span class="function"><span class="keyword">function</span> (<span class="params">context, next</span>) </span>&#123;</div><div class="line">    next();</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//在向客户端响应内容时</span></div><div class="line">DemoFilter.prototype.onResponse = <span class="function"><span class="keyword">function</span> (<span class="params">context, next</span>) </span>&#123;</div><div class="line">    next();</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//在请求即将结束时</span></div><div class="line">DemoFilter.prototype.onRequestEnd = <span class="function"><span class="keyword">function</span> (<span class="params">context, next</span>) </span>&#123;</div><div class="line">    next();</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>在应用中注册 Filter，在 <strong>应用配置 app.json</strong> 中配置:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"filters"</span>:&#123;</div><div class="line">        <span class="string">"^/"</span>:<span class="string">"./filters/demo-filter.js"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</div></article><div class="tags"></div><div class="paginator"><a href="/2016/04/13/using-nokitjs-to-solve-the-problem-of-cross-domain/" class="prev"><i class="iconfont icon-left"></i><span> 上一页</span></a><a href="/2015/10/18/iweb/" class="next"><span>下一页</span><i class="iconfont icon-right"></i></a></div><section id="comments"><div data-thread-key="http://blog.houfeng.net/2015/12/07/nokitjs/index.html" data-title="一个基于 Node.js 的 Web 开发框架 - Nokitjs" data-url="http://blog.houfeng.net/2015/12/07/nokitjs/index.html" class="ds-thread"></div><script type="text/javascript">var duoshuoQuery = {short_name: "houfeng" };
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></section></section><footer><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2009-2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Houfeng</span></p></div><label id="back2top"><i class="iconfont icon-up"></i></label></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>